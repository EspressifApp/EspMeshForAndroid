<div class="init-width">
    <div @click="hideUl" class="content-wrapper" id="device-wrapper">
        <div class="title-info">
            <h4 class="app-title">{{$t('nav.device')}}</h4>
            <i @click.stop="showUl($event)" class="icon-plus right-top"></i>
            <ul v-show="flag" class="add-ul">
                <li @click.stop="addDevice($event)"><i class="icon-light"></i><span>{{$t('addDevice')}}</span></li>
                <li @click.stop="addGroup($event)"><i class="icon-groups"></i><span>{{$t('addGroup')}}</span></li>
            </ul>
        </div>

        <div class="input-info">
            <i class="icon-search"></i>
            <input v-model="searchName" type="search" class="form-control" :placeholder="$t('search')">
        </div>
        <div class="content-info flex-wrapper" id="device-list">
            <mt-loadmore :top-method="loadTop" @top-status-change="handleTopChange" ref="loadmore">
                {{list}}
                <div v-if="!showAdd" v-infinite-scroll="loadMoreList"
                     infinite-scroll-disabled="loadMoreing"
                     infinite-scroll-distance="30">
                    <div v-for="item in loadList" :id="item.mac" :key="item.mac" v-longtap="{fn: showOperate, mac: item.mac}"
                          @click.self="operateItem(item)" class="item">
                        <div @click.stop="operateItem(item)" class="item-icon-circle">
                            <i :class="getIcon(item.tid)"
                               :style="{'color': getColor(item.characteristics, item.tid)}"></i>
                        </div>
                        <div @click.stop="operateItem(item)" class="item-name">
                            <span :class="{'cr-warning': getFlag(item.position)}">{{getPosition(item.position)}}</span>
                            <span  :class="{'desc': showDesc(item.position)}">{{item.name}}
                                <span v-show="showDesc(item.position)">({{item.version}})</span></span>
                            <span class="desc" v-show="!showDesc(item.position)">
                                {{item.version}}
                            </span>
                        </div>
                        <div class="item-power">
                            <div v-show="isLigth(item.tid)" class="switch-wrapper">
                                <span :class="{'active': !getStatus(item.characteristics)}" @click="close(item.mac, 0)">OFF</span>
                                <span :class="{'active': getStatus(item.characteristics)}" @click="close(item.mac, 1)">ON</span>
                            </div>
                            <div v-show="isSensor(item.tid, item.characteristics)" class="sensor-wrapper">
                                <span class="desc">temp: {{getSensorTemperature(item.characteristics)}}℃</span>
                                <span class="desc">humi: {{getSensorHumidity(item.characteristics)}}%</span>
                                <span class="desc">lumi: {{getSensorLuminance(item.characteristics)}}cd</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div v-if="showAdd" class="add-wrapper">
                    <h3>{{$t('addDevice')}}</h3>
                    <p>{{$t('listDesc')}}</p>
                    <div @click="addDevice($event)">
                        <i class="icon-plus"></i>
                    </div>
                </div>
                <div slot="top" class="mint-loadmore-top">
                    <span v-show="topStatus !== 'loading'" :class="{ 'rotate': topStatus === 'drop' }">↓</span>
                    <div v-show="topStatus === 'loading'" id="loader-wrapper-small">
                        <div class="loader loader-small"></div>
                        <div class="loader-section section-left"></div>
                        <div class="loader-section section-right"></div>
                    </div>
                </div>
            </mt-loadmore>
        </div>
        <v-load :loadDesc="loadDesc" ref="load"></v-load>
        <v-footer :current="device"></v-footer>
    </div>
    <transition name="ups">
        <div v-show="infoShow" class="operate-wrapper">
            <div @click="hideOperate" class="mask"></div>
            <div class="operate-info">
                <ul v-if="deviceInfo">
                    <li class="name">
                        <span class="title"><i :style="{'color': getColor(deviceInfo.characteristics, deviceInfo.tid)}"
                                               :class="getIcon(deviceInfo.tid)"></i>{{deviceInfo.name}}</span>
                        <div v-show="isLigth(deviceInfo.tid)" class="desc">
                            <div class="switch-wrapper">
                                <span :class="{'active': !getStatus(deviceInfo.characteristics)}" @click="operateClose(deviceInfo.mac, 0)">OFF</span>
                                <span :class="{'active': getStatus(deviceInfo.characteristics)}" @click="operateClose(deviceInfo.mac, 1)">ON</span>
                            </div>
                        </div>
                    </li>
                    <li @click="editName"><span>{{$t('editName')}}</span></li>
                    <li @click="delDevice"><span class="icon-orange">{{$t('reconfigure')}}</span></li>
                    <li @click="showAbout"><span>{{$t('aboutDevice')}}</span></li>
                    <li @click="showOta"><span>{{$t('otaUpdate')}}</span></li>
                    <li @click="showPair"><span>{{$t('location')}}</span></li>
                    <li @click="showAuto"><span>{{$t('association')}}</span></li>
                    <li @click="showCommand"><span>{{$t('command')}}</span></li>
                    <li @click="showIbeacon"><span>Ibeacon</span></li>
                    <li @click="hideOperate" class="margin-top-15 no-border"><span>{{$t('cancelBtn')}}</span></li>
                </ul>
            </div>

        </div>
    </transition>
    <v-resetDevice v-on:resetShow="onBackIndex" ref="device"></v-resetDevice>
    <v-joinDevice v-on:joinShow="onBackIndex" ref="join"></v-joinDevice>
    <v-addGroup v-on:addGroupShow="onBackIndex" v-if="deviceList.length > 0"
                :name="groupName" :addGroupId="addGroupId" ref="group"></v-addGroup>
    <v-operateDevice v-on:operateShow="onBackIndex" :colorId="colorId" :temperatureId="temperatureId"
                     ref="operate"></v-operateDevice>
    <v-aboutDevice v-on:aboutShow="onBackIndex" :deviceInfo="deviceInfo" v-if="deviceInfo" ref="aboutDevice"></v-aboutDevice>
    <v-otaInfo v-on:otaShow="onBackIndex" :otaId="otaDeviceId" :macs="otaMacs" v-if="deviceInfo" ref="ota"></v-otaInfo>
    <v-automation v-on:autoShow="onBackIndex" :deviceInfo="deviceInfo" :autoId="autoId"
                  v-if="deviceInfo" ref="auto"></v-automation>
    <v-ibeacon v-on:ibeanShow="onBackIndex" :deviceInfo="deviceInfo" v-if="deviceInfo" ref="ibeacon"></v-ibeacon>
    <v-scanDevice v-on:scanDeviceShow="onBackIndex" ref="scanDevice"></v-scanDevice>
    <v-attr v-on:attrShow="onBackIndex" ref="attr"></v-attr>
    <v-remind ref="remind"></v-remind>
    <v-setDevicePair v-on:setDevicePairShow="onBackIndex" ref="setDevicePair"></v-setDevicePair>
    <v-command v-on:commandShow="onBackIndex" :commandMacs="commandMacs" ref="command"></v-command>
</div>
